parsers: # array
    # - reg: ^.*$ åŒ¹é…æ‰€æœ‰è®¢é˜…ï¼Œæˆ–  - url: https://example.com/profile.yaml æŒ‡å®šè®¢é˜…
    - reg: ^.*$
      # åˆ é™¤æœåŠ¡å•†æä¾›çš„ç­–ç•¥ç»„å’Œè§„åˆ™
      code: |
        // å¸¸é‡å®šä¹‰

        // å®šä¹‰éœ€è¦åˆ é™¤çš„åŒ…å«å…³é”®è¯çš„èŠ‚ç‚¹
        const KEYWORDS_TO_CHECK = new Set(['25å€']);

        // å®šä¹‰éœ€è¦ç§»é™¤çš„èŠ‚ç‚¹åç§°ä¸­çš„å­—ç¬¦ä¸²
        const KEYWORDS_TO_REMOVE = new Set([
            'Lv3 ',
            ' [2.0]',
            'ğŸ‡­ğŸ‡°', 'ğŸ‡¹ğŸ‡¼', 'ğŸ‡¸ğŸ‡ª', 'ğŸ‡©ğŸ‡ª', 'ğŸ‡¨ğŸ‡³', 'ğŸ‡¯ğŸ‡µ', 'ğŸ‡¸ğŸ‡¬', 'ğŸ‡ºğŸ‡¸', 'ğŸ‡°ğŸ‡·', 'ğŸ‡¦ğŸ‡º', 'ğŸ‡®ğŸ‡³',
            'ğŸ‡¨ğŸ‡¦', 'ğŸ‡²ğŸ‡½', 'ğŸ‡®ğŸ‡¹', 'ğŸ‡³ğŸ‡±', 'ğŸ‡ªğŸ‡¸', 'ğŸ‡¬ğŸ‡§', 'ğŸ‡«ğŸ‡·', 'ğŸ‡®ğŸ‡±', 'ğŸ‡¸ğŸ‡¦', 'ğŸ‡¿ğŸ‡¦', 'ğŸ‡¦ğŸ‡ª',
            'ğŸ‡§ğŸ‡·', 'ğŸ‡¨ğŸ‡±', 'ğŸ‡¨ğŸ‡´', 'ğŸ‡¨ğŸ‡­', 'ğŸ‡¹ğŸ‡­',
            '[Trojan]',
            '[å€ç‡:0.8]', '[å€ç‡:0.9]', '[å€ç‡:1]',
        ]);

        // éœ€è¦æ·»åŠ çš„å…³é”®è¯ï¼Œåœ¨å‰é¢æ·»åŠ åŠ¨ç‰©å¤´åƒ
        const KEYWORDS_TO_ADD = {
            'é¦™æ¸¯|æ¸¯': 'ğŸ¬ ',
            'å°æ¹¾|å°': 'ğŸ¸ ',
            'æ¾³é—¨': 'ğŸ¹ ',
            'ç¾å›½|åŠ æ‹¿å¤§': 'ğŸ¦… ',
            'æ—¥æœ¬': 'ğŸ” ',
            'éŸ©å›½': 'ğŸ¶ ',
            'å°åº¦|æ³°å›½': 'ğŸ˜ ',
            'æ–°åŠ å¡|é©¬æ¥è¥¿äºš': 'ğŸµ ',
            'æ¾³å¤§åˆ©äºš': 'ğŸ¨ ',
            'è¿ªæ‹œ|æ²™ç‰¹é˜¿æ‹‰ä¼¯|é˜¿è”é…‹|ä»¥è‰²åˆ—|å—é': 'ğŸª ',
            'å·´è¥¿|å¢¨è¥¿å“¥|æ™ºåˆ©|å“¥ä¼¦æ¯”äºš': 'ğŸ¦œ ',
            'ä¿„ç½—æ–¯': 'ğŸ» ',
            'å¾·å›½|è‹±å›½|ç‘å…¸|æ³•å›½|è·å…°|åœŸè€³å…¶|æ„å¤§åˆ©|è¥¿ç­ç‰™|ç‘å£«': 'ğŸ¦„ '
        };

        // éœ€è¦æ›¿æ¢çš„æ–‡æœ¬
        const REPLACE_MAP = {
            'å‚»é€¼': 'SB'
        };

        // å®šä¹‰å¤„ç†åçš„ rules é…ç½®
        const rulesConfig = [
            // è‡ªå®šä¹‰ç¨‹åºè§„åˆ™
            "PROCESS-NAME,DownloadServer.exe,DIRECT",           // PikPak ç›´è¿
            "PROCESS-NAME,PikPak.exe,DIRECT",                   // PikPak ç›´è¿
            "PROCESS-NAME,WinStore.App.exe,DIRECT",             // Microsoft store ç›´è¿
            "PROCESS-NAME,ForzaHorizon5.exe,DIRECT",            // Forza Horizon 5 ç›´è¿
            "PROCESS-NAME,SearchApp.exe,DIRECT",                // SearchApp ç›´è¿

            // è‡ªå®šä¹‰è§„åˆ™ï¼ˆç›´è¿ï¼‰
            //"DOMAIN-SUFFIX,challenges.cloudflare.com,DIRECT",
            "DOMAIN-SUFFIX,agaghhh.cc,DIRECT",                 // x1080x ç›¸å…³åŸŸåç›´è¿
            "DOMAIN-SUFFIX,nvidia.com,DIRECT",                 // NVIDIA ç›¸å…³åŸŸåç›´è¿
            "DOMAIN-SUFFIX,bing.com,DIRECT",                   // Bing ç›¸å…³åŸŸåç›´è¿
            "DOMAIN-SUFFIX,adobe.io,REJECT",                   // é˜²æ­¢ adobe å¼¹çª—
            "DOMAIN,lcs-cops.adobe.io,DIRECT",                 // é˜²æ­¢ adobe å¼¹çª—
            //"DOMAIN-SUFFIX,steamstatic.com,DIRECT",          // Steam é™æ€èµ„æºåŸŸåç›´è¿
            //"DOMAIN-SUFFIX,steamserver.net,DIRECT",          // Steam æœåŠ¡å™¨åŸŸåç›´è¿
            "DOMAIN-SUFFIX,akamaihd.net,DIRECT",               // Akamai CDN åŸŸåç›´è¿
            "DOMAIN-SUFFIX,emojiall.com,DIRECT",               // emojiall åŸŸåç›´è¿
            "DOMAIN-SUFFIX,clash.razord.top,DIRECT",           // clash.razord.top åŸŸåç›´è¿
            "DOMAIN-SUFFIX,yacd.haishan.me,DIRECT",            // yacd.haishan.me åŸŸåç›´è¿

            // è‡ªå®šä¹‰è§„åˆ™ï¼ˆä»£ç†)
            //"DOMAIN-SUFFIX,store-images.s-microsoft.com,ğŸš€ èŠ‚ç‚¹é€‰æ‹©",
            "DOMAIN-SUFFIX,tuj.microsoftsa.com,ğŸ” æˆ‘è¦æ¶©æ¶©",
            "DOMAIN-SUFFIX,sehuatang.net,ğŸ” æˆ‘è¦æ¶©æ¶©",               // sehuatang.net åŸŸåä½¿ç”¨ ğŸš€ èŠ‚ç‚¹é€‰æ‹©ç­–ç•¥
            "DOMAIN-SUFFIX,javbus.com,ğŸš€ èŠ‚ç‚¹é€‰æ‹©",                  // javbus.com åŸŸåä½¿ç”¨ ğŸš€ èŠ‚ç‚¹é€‰æ‹©ç­–ç•¥
            "DOMAIN-KEYWORD,javdb,ğŸ” æˆ‘è¦æ¶©æ¶©",                      // åŒ…å« javdb å…³é”®è¯çš„åŸŸåä½¿ç”¨ ğŸ” æˆ‘è¦æ¶©æ¶©ç­–ç•¥
            "DOMAIN-SUFFIX,jdbstatic.com,ğŸ” æˆ‘è¦æ¶©æ¶©",               // jdbstatic.com åŸŸåä½¿ç”¨ ğŸ” æˆ‘è¦æ¶©æ¶©ç­–ç•¥
            "DOMAIN-SUFFIX,ptt.cc,â±ï¸ å»¶è¿Ÿé€‰ä¼˜",                      // ptt.cc åŸŸåä½¿ç”¨ â±ï¸ å»¶è¿Ÿé€‰ä¼˜ç­–ç•¥
            "DOMAIN-SUFFIX,urlimage.cc,ğŸ¤– ChatGPT",
            "DOMAIN-KEYWORD,sijishe,ğŸ¤– ChatGPT",
            "DOMAIN-SUFFIX,sjscn.cc,ğŸ¤– ChatGPT",
            "DOMAIN-KEYWORD,sjs47,ğŸ¤– ChatGPT",
            "DOMAIN-SUFFIX,nicovideo.jp,ğŸŒ æ—¥æœ¬èŠ‚ç‚¹",                // nicovideo.jp åŸŸåä½¿ç”¨ ğŸŒ æ—¥æœ¬èŠ‚ç‚¹ç­–ç•¥
            "DOMAIN-KEYWORD,coolaler,ğŸŒ æ—¥æœ¬èŠ‚ç‚¹",                   // åŒ…å« coolaler å…³é”®è¯çš„åŸŸåä½¿ç”¨ ğŸŒ æ—¥æœ¬èŠ‚ç‚¹ç­–ç•¥
            // "DOMAIN-SUFFIX,googleapis.cn,ğŸš€ èŠ‚ç‚¹é€‰æ‹©",
            // "DOMAIN-SUFFIX,gstatic.com,ğŸš€ èŠ‚ç‚¹é€‰æ‹©",
            // "DOMAIN-SUFFIX,xn--ngstr-lra8j.com,ğŸš€ èŠ‚ç‚¹é€‰æ‹©",
            // "DOMAIN-SUFFIX,github.io,ğŸš€ èŠ‚ç‚¹é€‰æ‹©",
            // "DOMAIN,v2rayse.com,ğŸš€ èŠ‚ç‚¹é€‰æ‹©",

            // è‡ªå®šä¹‰è§„åˆ™é›†
            "RULE-SET,cloudflarecn,DIRECT",                      // ä½¿ç”¨ cloudflarecn è§„åˆ™é›†ï¼Œç›´è¿
            "RULE-SET,cloudflare,â±ï¸ å»¶è¿Ÿé€‰ä¼˜",                   // ä½¿ç”¨ cloudflare è§„åˆ™é›†ï¼Œä½¿ç”¨ â±ï¸ å»¶è¿Ÿé€‰ä¼˜ç­–ç•¥
            "RULE-SET,steamcn,DIRECT",                           // ä½¿ç”¨ steamcn è§„åˆ™é›†ï¼Œç›´è¿
            "RULE-SET,xbox,DIRECT",                              // ä½¿ç”¨ xbox è§„åˆ™é›†ï¼Œç›´è¿
            "RULE-SET,trackerslist,DIRECT",                     // ä½¿ç”¨ trackerslist è§„åˆ™é›†ï¼Œç›´è¿
            "RULE-SET,dmm,ğŸŒ æ—¥æœ¬èŠ‚ç‚¹",                          // ä½¿ç”¨ dmm è§„åˆ™é›†ï¼Œä½¿ç”¨ ğŸŒ æ—¥æœ¬èŠ‚ç‚¹ç­–ç•¥
            "RULE-SET,ai,ğŸ¤– ChatGPT",                           // ä½¿ç”¨ ai è§„åˆ™é›†ï¼Œä½¿ç”¨â€œğŸ¤– ChatGPTâ€ç­–ç•¥
            "RULE-SET,youtube,ğŸš€ èŠ‚ç‚¹é€‰æ‹©",                      // ä½¿ç”¨ youtube è§„åˆ™é›†ï¼Œä½¿ç”¨ ğŸš€ èŠ‚ç‚¹é€‰æ‹©ç­–ç•¥
            "RULE-SET,netflix,ğŸš€ èŠ‚ç‚¹é€‰æ‹©",                      // ä½¿ç”¨ netflix è§„åˆ™é›†ï¼Œä½¿ç”¨ ğŸš€ èŠ‚ç‚¹é€‰æ‹©ç­–ç•¥

            // å®˜æ–¹è§„åˆ™é›†
            "RULE-SET,telegramip,ğŸš€ èŠ‚ç‚¹é€‰æ‹©,no-resolve",       // ä½¿ç”¨ telegramip è§„åˆ™é›†ï¼Œä½¿ç”¨ ğŸš€ èŠ‚ç‚¹é€‰æ‹©ç­–ç•¥ï¼Œä¸è§£æ
            "RULE-SET,icloud,DIRECT",                           // ä½¿ç”¨ icloud è§„åˆ™é›†ï¼Œç›´è¿
            "RULE-SET,applications,DIRECT",                     // ä½¿ç”¨ applications è§„åˆ™é›†ï¼Œç›´è¿
            "RULE-SET,privateip,DIRECT",                        // ä½¿ç”¨ privateip è§„åˆ™é›†ï¼Œç›´è¿
            "RULE-SET,private,DIRECT",                          // ä½¿ç”¨ private è§„åˆ™é›†ï¼Œç›´è¿
            "RULE-SET,networktest,DIRECT",                      // ä½¿ç”¨ networktest è§„åˆ™é›†ï¼Œç›´è¿
            "RULE-SET,apple-cn,DIRECT",                         // ä½¿ç”¨ apple è§„åˆ™é›†ï¼Œç›´è¿
            "RULE-SET,google-cn,DIRECT",                        // ä½¿ç”¨ google è§„åˆ™é›†ï¼Œç›´è¿
            "RULE-SET,microsoft-cn,DIRECT",                     // ä½¿ç”¨ microsoft-cn è§„åˆ™é›†ï¼Œç›´è¿
            "RULE-SET,games-cn,DIRECT",                         // ä½¿ç”¨ games-cn è§„åˆ™é›†ï¼Œç›´è¿
            "RULE-SET,tld-proxy,ğŸš€ èŠ‚ç‚¹é€‰æ‹©",                   // ä½¿ç”¨ tld-proxy è§„åˆ™é›†ï¼Œä½¿ç”¨ ğŸš€ èŠ‚ç‚¹é€‰æ‹©ç­–ç•¥
            "RULE-SET,cn-lite,DIRECT",                          // ä½¿ç”¨ cn-lite è§„åˆ™é›†ï¼Œç›´è¿
            "RULE-SET,mediaip,ğŸš€ èŠ‚ç‚¹é€‰æ‹©",                     // ä½¿ç”¨ mediaip è§„åˆ™é›†ï¼Œä½¿ç”¨ ğŸš€ èŠ‚ç‚¹é€‰æ‹©ç­–ç•¥
            "RULE-SET,media,ğŸš€ èŠ‚ç‚¹é€‰æ‹©",                       // ä½¿ç”¨ media è§„åˆ™é›†ï¼Œä½¿ç”¨ ğŸš€ èŠ‚ç‚¹é€‰æ‹©ç­–ç•¥
            "RULE-SET,gfw,ğŸš€ èŠ‚ç‚¹é€‰æ‹©",                         // ä½¿ç”¨ gfw è§„åˆ™é›†ï¼Œä½¿ç”¨ ğŸš€ èŠ‚ç‚¹é€‰æ‹©ç­–ç•¥
            "RULE-SET,cnip,DIRECT",                             // ä½¿ç”¨ cnip è§„åˆ™é›†ï¼Œç›´è¿
            "RULE-SET,proxy,ğŸš€ èŠ‚ç‚¹é€‰æ‹©",                       // ä½¿ç”¨ proxy è§„åˆ™é›†ï¼Œä½¿ç”¨ ğŸš€ èŠ‚ç‚¹é€‰æ‹©ç­–ç•¥
            "RULE-SET,cn,DIRECT",                               // ä½¿ç”¨ cn è§„åˆ™é›†ï¼Œç›´è¿
            "RULE-SET,ads,REJECT",                              // ä½¿ç”¨ reject è§„åˆ™é›†ï¼Œæ‹’ç»

            // IP è§„åˆ™
            "DOMAIN-SUFFIX,local,DIRECT,no-resolve",           // local åŸŸåç›´è¿ï¼Œä¸è§£æ
            "IP-CIDR,127.0.0.0/8,DIRECT,no-resolve",           // 127.0.0.0/8 IP æ®µç›´è¿ï¼Œä¸è§£æ
            "IP-CIDR,172.16.0.0/12,DIRECT,no-resolve",         // 172.16.0.0/12 IP æ®µç›´è¿ï¼Œä¸è§£æ
            "IP-CIDR,192.168.0.0/16,DIRECT,no-resolve",        // 192.168.0.0/16 IP æ®µç›´è¿ï¼Œä¸è§£æ
            "IP-CIDR,10.0.0.0/8,DIRECT,no-resolve",            // 10.0.0.0/8 IP æ®µç›´è¿ï¼Œä¸è§£æ
            "IP-CIDR,17.0.0.0/8,DIRECT,no-resolve",            // 17.0.0.0/8 IP æ®µç›´è¿ï¼Œä¸è§£æ
            "IP-CIDR,100.64.0.0/10,DIRECT,no-resolve",         // 100.64.0.0/10 IP æ®µç›´è¿ï¼Œä¸è§£æ
            "IP-CIDR,224.0.0.0/4,DIRECT,no-resolve",           // 224.0.0.0/4 IP æ®µç›´è¿ï¼Œä¸è§£æ
            "IP-CIDR6,fe80::/10,DIRECT,no-resolve",            // fe80::/10 IPv6 æ®µç›´è¿ï¼Œä¸è§£æ
            "GEOIP,LAN,DIRECT",                                // LAN GEOIP ç›´è¿
            "GEOIP,CN,DIRECT",                                 // CN GEOIP ç›´è¿
            "MATCH,ğŸš€ èŠ‚ç‚¹é€‰æ‹©"                                // é»˜è®¤ä½¿ç”¨ ğŸš€ èŠ‚ç‚¹é€‰æ‹©ç­–ç•¥
        ];

        // å‡½æ•°å®šä¹‰
        // åˆ é™¤ name å­—æ®µä¸­åŒ…å«æŒ‡å®šå…³é”®è¯çš„éƒ¨åˆ†
        const removeKeywords = (name, keywords) =>
            [...keywords].reduce((result, keyword) => result.replace(keyword, ''), name);

        // åœ¨ name å­—æ®µå‰é¢æ·»åŠ æŒ‡å®šå…³é”®è¯
        const addKeywords = (name, keywordMap) => {
            for (const [keys, value] of Object.entries(keywordMap)) {
                const regex = new RegExp(keys.split('|').join('|'));
                if (regex.test(name)) {
                    return value + name;
                }
            }
            return name;
        };

        // æ‰¹é‡æ›¿æ¢ name å­—æ®µä¸­çš„æ–‡æœ¬
        const replaceText = (name, replaceMap) =>
            Object.entries(replaceMap).reduce((result, [search, replacement]) =>
                result.replace(new RegExp(search, 'g'), replacement), name);

        module.exports.parse = async (raw, { axios, yaml, notify, console }, { name, url, interval, selected }) => {
            const rawObj = yaml.parse(raw);

            // è¿‡æ»¤æ‰ proxies ä¸­ name å­—æ®µåŒ…å«æŒ‡å®šå…³é”®è¯çš„ä»£ç†é…ç½®
            if (Array.isArray(rawObj.proxies)) {
                rawObj.proxies = rawObj.proxies.filter(proxy =>
                    !KEYWORDS_TO_CHECK.has(proxy.name)  // ç¡®ä¿ä»£ç†çš„ name å­—æ®µä¸åŒ…å«ä»»ä½•ä¸€ä¸ªå…³é”®è¯
                );
            }

            // å¤„ç† proxies æ•°ç»„
            if (Array.isArray(rawObj.proxies)) {
                rawObj.proxies = rawObj.proxies.map(proxy => {
                    proxy.name = removeKeywords(proxy.name, KEYWORDS_TO_REMOVE);
                    proxy.name = addKeywords(proxy.name, KEYWORDS_TO_ADD);
                    proxy.name = replaceText(proxy.name, REPLACE_MAP);
                    return proxy;
                });

                // æ— è®ºä»£ç†æ•°ç»„å†…å®¹å¦‚ä½•ï¼Œç›´æ¥æ·»åŠ ä¸€ä¸ªåä¸ºâ€œğŸˆšï¸ æ— ç›¸å…³èŠ‚ç‚¹â€çš„èŠ‚ç‚¹
                rawObj.proxies.push({
                    name: 'ğŸˆšï¸ æ— ç›¸å…³èŠ‚ç‚¹',
                    type: 'ss',
                    server: '0.0.0.0',
                    port: 443,
                    password: 111,
                    cipher: 'chacha20-ietf-poly1305',
                    udp: true,
                    // å…¶ä»–å¯èƒ½éœ€è¦çš„å±æ€§å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ 
                });
            }

            // è¿‡æ»¤ proxies æ•°ç»„ä¸­çš„ä»£ç†é…ç½®
            const PROXIES_KEYWORDS_TO_REMOVE = [
                'å‰©ä½™',
                'ink',
                '[å€ç‡:2.5]',
                '[å€ç‡:2]',
                'x2',
                'x3',
                'é˜²å¤±è”',
                'ä¸€å…ƒæœºåœº.ink',
                'å€ç‡æ˜¯æµé‡æ¶ˆè€—å¿«æ…¢è€Œéé€Ÿåº¦å¿«æ…¢',
                'èŠ‚ç‚¹è¶…æ—¶è¯·',
                'å®˜ç½‘',
                'æ”¶è—å¯¼èˆª',
                'å¥—é¤åˆ°æœŸ',
                'é•¿æœŸæœ‰æ•ˆ',
                'ğŸˆšï¸ æ— ç›¸å…³èŠ‚ç‚¹'
            ];

            const filterProxies = (proxies) => proxies
                .map(proxy => proxy.name) // æå–ä»£ç†çš„ name å­—æ®µ
                .filter(name => !PROXIES_KEYWORDS_TO_REMOVE.some(keyword => name.includes(keyword))); // æ’é™¤åŒ…å«æŒ‡å®šå…³é”®è¯çš„ä»£ç†åç§°

            const allProxies = rawObj.proxies.map(proxy => proxy.name); // è·å–æ‰€æœ‰ä»£ç†çš„ name å­—æ®µ
            const filteredProxies = filterProxies(rawObj.proxies); // ä½¿ç”¨ filterProxies å‡½æ•°è¿‡æ»¤ä»£ç†

            const furtherFilter = (proxies, includeKeywords = [], excludeKeywords = []) => proxies
                .filter(name => includeKeywords.length === 0 || includeKeywords.some(keyword => name.includes(keyword))) // åŒ…å«æŒ‡å®šå…³é”®è¯
                .filter(name => excludeKeywords.length === 0 || !excludeKeywords.some(keyword => name.includes(keyword))); // æ’é™¤æŒ‡å®šå…³é”®è¯

            const filteredJapanProxies = furtherFilter(filteredProxies, ['æ—¥æœ¬'], []); // ä»…åŒ…å«æ—¥æœ¬ä»£ç†
            const filteredRichProxies = furtherFilter(allProxies, ['x2', 'x3', '[å€ç‡:1.7]', '[å€ç‡:2]', '[å€ç‡:2.5]'], []); // åŒ…å«å…¨éƒ¨èŠ‚ç‚¹é‡Œé¢çš„é«˜å€ç‡ä»£ç†

            // æå–é‡å¤çš„é…ç½®é¡¹ä¸ºä¸€ä¸ªå¯¹è±¡
            const commonConfig = {
                interval: 1800,                                  // ä»£ç†ç»„æ£€æŸ¥é—´éš”,è‡ªåŠ¨æµ‹è¯•é—´éš”æ—¶é—´ï¼Œå•ä½ç§’ï¼Œé select ç±»å‹åˆ†ç»„å¿…è¦
                timeout: 1800,                                  // è¶…æ—¶æ—¶é—´
                url: "http://www.gstatic.com/generate_204",    // æ£€æŸ¥URL,æµ‹è¯•åœ°å€ï¼Œé select ç±»å‹åˆ†ç»„å¿…è¦
                lazy: true,                                     // å¯ç”¨æ‡’åŠ è½½ï¼Œæ²¡é€‰ä¸­å°±ä¸éœ€è¦æ£€æµ‹
                maxFailedTimes: 3,                              // æœ€å¤§å¤±è´¥æ¬¡æ•°
                hidden: false                                   // æ˜¯å¦éšè—ä»£ç†ç»„
            };

            /*
                ç­–ç•¥ç»„ type ç±»å‹è¯´æ˜
                    select         # æ‰‹åŠ¨é€‰ç‚¹
                    url-test       # è‡ªåŠ¨é€‰æ‹©å»¶è¿Ÿæœ€ä½çš„èŠ‚ç‚¹
                    fallback       # èŠ‚ç‚¹æ•…éšœæ—¶è‡ªåŠ¨åˆ‡æ¢ä¸‹ä¸€ä¸ª
                    load-balance   # å‡è¡¡ä½¿ç”¨åˆ†ç»„å†…çš„èŠ‚ç‚¹
            
                è´Ÿè½½å‡è¡¡ load-balance ç­–ç•¥è¯´æ˜
                    round-robin         å°†ä¼šæŠŠæ‰€æœ‰çš„è¯·æ±‚åˆ†é…ç»™ç­–ç•¥ç»„å†…ä¸åŒçš„ä»£ç†èŠ‚ç‚¹
                    consistent-hashing  å°†ç›¸åŒçš„ ç›®æ ‡åœ°å€ çš„è¯·æ±‚åˆ†é…ç»™ç­–ç•¥ç»„å†…çš„åŒä¸€ä¸ªä»£ç†èŠ‚ç‚¹
                    sticky-sessions     å°†ç›¸åŒçš„ æ¥æºåœ°å€ å’Œ ç›®æ ‡åœ°å€ çš„è¯·æ±‚åˆ†é…ç»™ç­–ç•¥ç»„å†…çš„åŒä¸€ä¸ªä»£ç†èŠ‚ç‚¹ï¼Œç¼“å­˜ 10 åˆ†é’Ÿè¿‡æœŸ
            */

            // å®šä¹‰ä»£ç†ç»„é…ç½®
            const proxyGroups = [
                {
                    name: 'ğŸš€ èŠ‚ç‚¹é€‰æ‹©',
                    ...commonConfig,                  // å¼•å…¥é€šç”¨é…ç½®
                    type: "select",                   // é€‰æ‹©ç±»å‹
                    proxies: [
                        'â±ï¸ å»¶è¿Ÿé€‰ä¼˜',
                        'â™»ï¸ è´Ÿè½½å‡è¡¡',
                        'ğŸš‘ æ•…éšœè½¬ç§»',
                        'ğŸ’ åœŸè±ªä¸“ç”¨',
                        ...allProxies                  // åŒ…å«æ‰€æœ‰ä»£ç†
                    ]
                },
                {
                    name: 'ğŸ“¢ å…¬å‘Šå±•ç¤º',
                    ...commonConfig,
                    type: "select",
                    proxies: allProxies
                },
                {
                    name: 'ğŸ¤– ChatGPT',
                    ...commonConfig,
                    type: "url-test",                   // URL æµ‹è¯•ç±»å‹
                    interval: 1800,                   // è‡ªåŠ¨æµ‹è¯•é—´éš”æ—¶é—´ï¼Œå•ä½ç§’
                    tolerance: 50,                    // å…è®¸çš„å»¶è¿Ÿåå·®ï¼Œå•ä½ä¸ºæ¯«ç§’
                    url: "https://chatgpt.com",
                    proxies: furtherFilter(filteredProxies, [], ['é¦™æ¸¯', 'å¹¿æ¸¯', 'æ¾³é—¨']) // è¿‡æ»¤æ‰é¦™æ¸¯ã€å¹¿æ¸¯ã€æ¾³é—¨çš„ä»£ç†
                },
                {
                    name: 'ğŸ” æˆ‘è¦æ¶©æ¶©',
                    ...commonConfig,
                    type: "load-balance",               // è´Ÿè½½å‡è¡¡ç±»å‹
                    strategy: "consistent-hashing",     // è´Ÿè½½å‡è¡¡ç­–ç•¥
                    proxies: furtherFilter(filteredProxies, [], ['æ—¥æœ¬']) // è¿‡æ»¤æ‰æ—¥æœ¬çš„ä»£ç†
                },
                {
                    name: 'ğŸŒ æ—¥æœ¬èŠ‚ç‚¹',
                    ...commonConfig,
                    type: filteredJapanProxies.length > 0 ? "load-balance" : "select",
                    strategy: filteredJapanProxies.length > 0 ? "consistent-hashing" : undefined,
                    proxies: filteredJapanProxies.length > 0
                        ? filteredJapanProxies
                        : [
                            'ğŸˆšï¸ æ— ç›¸å…³èŠ‚ç‚¹',
                            'â™»ï¸ è´Ÿè½½å‡è¡¡',
                            'â±ï¸ å»¶è¿Ÿé€‰ä¼˜',
                            'ğŸš‘ æ•…éšœè½¬ç§»'
                        ] // å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°ç›¸å…³èŠ‚ç‚¹ï¼Œåˆ™æ·»åŠ â€œğŸˆšï¸ æ— ç›¸å…³èŠ‚ç‚¹â€ç»„
                },
                {
                    name: 'ğŸ’ åœŸè±ªä¸“ç”¨',
                    ...commonConfig,
                    type: filteredRichProxies.length > 0 ? "load-balance" : "select",
                    strategy: filteredRichProxies.length > 0 ? "consistent-hashing" : undefined,
                    proxies: filteredRichProxies.length > 0
                        ? filteredRichProxies
                        : [
                            'ğŸˆšï¸ æ— ç›¸å…³èŠ‚ç‚¹',
                            'â™»ï¸ è´Ÿè½½å‡è¡¡',
                            'â±ï¸ å»¶è¿Ÿé€‰ä¼˜',
                            'ğŸš‘ æ•…éšœè½¬ç§»'
                        ]
                },
                {
                    name: 'â™»ï¸ è´Ÿè½½å‡è¡¡',
                    ...commonConfig,
                    type: "load-balance",
                    strategy: "consistent-hashing",
                    proxies: filteredProxies           // ç»è¿‡è¿‡æ»¤çš„ä»£ç†
                },
                {
                    name: 'â±ï¸ å»¶è¿Ÿé€‰ä¼˜',
                    ...commonConfig,
                    type: "url-test",
                    interval: 1800,
                    tolerance: 50,
                    proxies: filteredProxies
                },
                {
                    name: 'ğŸš‘ æ•…éšœè½¬ç§»',
                    ...commonConfig,
                    type: "fallback",                 // æ•…éšœè½¬ç§»ç±»å‹
                    proxies: filteredProxies
                }
            ];

            // å°† proxyGroups æ·»åŠ åˆ° rawObj ä¸­
            rawObj['proxy-groups'] = proxyGroups;

            // å°†å¤„ç†åçš„ rules é…ç½®æ·»åŠ åˆ° rawObj ä¸­
            rawObj.rules = rulesConfig;

            // æå–é‡å¤çš„é…ç½®é¡¹ä¸ºä¸€ä¸ªå¯¹è±¡
            const commonRuleProviderConfig = {
                type: 'http',
                format: 'mrs',
                interval: 86400
            };

            // å®šä¹‰ rule-providers é…ç½®
            const ruleProvidersConfig = {
                ads: {
                    ...commonRuleProviderConfig,
                    behavior: 'domain',
                    url: 'https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/ads.mrs',
                },
                icloud: {
                    ...commonRuleProviderConfig,
                    behavior: 'domain',
                    url: 'https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@refs/heads/meta/geo/geosite/icloud.mrs',
                },
                'apple-cn': {
                    ...commonRuleProviderConfig,
                    behavior: 'domain',
                    url: 'https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/apple-cn.mrs',
                },
                'google-cn': {
                    ...commonRuleProviderConfig,
                    behavior: 'domain',
                    url: 'https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/google-cn.mrs',
                },
                proxy: {
                    ...commonRuleProviderConfig,
                    behavior: 'domain',
                    url: 'https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/proxy.mrs',
                },
                cn: {
                    ...commonRuleProviderConfig,
                    behavior: 'domain',
                    url: 'https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/cn.mrs',
                },
                'cn-lite': {
                    ...commonRuleProviderConfig,
                    behavior: 'domain',
                    url: 'https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/cn-lite.mrs',
                },
                cnip: {
                    ...commonRuleProviderConfig,
                    behavior: 'ipcidr',
                    url: 'https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/cnip.mrs',
                },
                media: {
                    ...commonRuleProviderConfig,
                    behavior: 'domain',
                    url: 'https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/media.mrs',
                },
                mediaip: {
                    ...commonRuleProviderConfig,
                    behavior: 'ipcidr',
                    url: 'https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/mediaip.mrs',
                },
                private: {
                    ...commonRuleProviderConfig,
                    behavior: 'domain',
                    url: 'https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/private.mrs',
                },
                gfw: {
                    ...commonRuleProviderConfig,
                    behavior: 'domain',
                    url: 'https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/gfw.mrs',
                },
                'tld-proxy': {
                    ...commonRuleProviderConfig,
                    behavior: 'domain',
                    url: 'https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/tld-proxy.mrs',
                },
                telegramip: {
                    ...commonRuleProviderConfig,
                    behavior: 'ipcidr',
                    url: 'https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/telegramip.mrs',
                },
                privateip: {
                    ...commonRuleProviderConfig,
                    behavior: 'ipcidr',
                    url: 'https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/privateip.mrs',
                },
                applications: {
                    ...commonRuleProviderConfig,
                    format: 'text',
                    behavior: 'classical',
                    url: 'https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/applications.list',
                },
                ai: {
                    ...commonRuleProviderConfig,
                    behavior: 'domain',
                    url: 'https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/ai.mrs',
                },
                youtube: {
                    ...commonRuleProviderConfig,
                    behavior: 'domain',
                    url: 'https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/youtube.mrs',
                },
                netflix: {
                    ...commonRuleProviderConfig,
                    behavior: 'domain',
                    url: 'https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/youtube.mrs',
                },
                xbox: {
                    ...commonRuleProviderConfig,
                    behavior: 'domain',
                    url: 'https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@refs/heads/meta/geo/geosite/xbox.mrs'
                },
                dmm: {
                    ...commonRuleProviderConfig,
                    behavior: 'domain',
                    url: 'https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@refs/heads/meta/geo/geosite/dmm.mrs',
                },
                cloudflare: {
                    ...commonRuleProviderConfig,
                    behavior: 'domain',
                    url: 'https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@refs/heads/meta/geo/geosite/cloudflare.mrs'
                },
                cloudflarecn: {
                    ...commonRuleProviderConfig,
                    behavior: 'domain',
                    url: 'https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@refs/heads/meta/geo/geosite/cloudflare%40cn.mrs'
                },
                steamcn: {
                    ...commonRuleProviderConfig,
                    behavior: 'domain',
                    url: 'https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@refs/heads/meta/geo/geosite/steam%40cn.mrs'
                },
                'microsoft-cn': {
                    ...commonRuleProviderConfig,
                    behavior: 'domain',
                    url: 'https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/microsoft-cn.mrs'
                },
                trackerslist: {
                    ...commonRuleProviderConfig,
                    behavior: 'domain',
                    url: 'https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/trackerslist.mrs'
                },
                'games-cn': {
                    ...commonRuleProviderConfig,
                    behavior: 'domain',
                    url: 'https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/games-cn.mrs'
                },
                networktest: {
                    ...commonRuleProviderConfig,
                    behavior: 'domain',
                    url: 'https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/networktest.mrs'
                }
            };

            // åˆå§‹åŒ– proxy-providers é…ç½®
            rawObj['proxy-providers'] = {};

            // å°† rule-providers é…ç½®æ·»åŠ åˆ° rawObj ä¸­
            rawObj['rule-providers'] = ruleProvidersConfig;

            // å›½å†…DNSæœåŠ¡å™¨åˆ—è¡¨
            const DNS_CN = [
                '223.6.6.6',                                // é˜¿é‡Œäº‘ DNS
                '119.29.29.29',                             // DNSPod
                '114.114.115.115',                          // 114DNS
                // 'https://doh.pub/dns-query',             // DOH.PUB
                // 'https://dns.alidns.com/dns-query',      // é˜¿é‡Œäº‘ DNS
                // 'https://doh.onedns.net/dns-query',      // OneDNS
                // 'https://doh.360.cn/dns-query',          // 360 DNS
            ];
            // å›½å¤–DNSæœåŠ¡å™¨åˆ—è¡¨
            const DNS_GLOBAL = [
                '1.1.1.1',                                  // Cloudflare DNS
                '8.8.8.8',                                  // Google DNS
                '9.9.9.9',                                  // Quad9 DNS
                '205.171.3.65',                             // Verisign DNS
                // 'https://1.1.1.1/dns-query',             // Cloudflare DNS
                // 'https://dns.google/dns-query',          // Google DNS
                // 'https://dns.quad9.net/dns-query',       // Quad9 DNS
                // 'https://dns.yandex.ru/dns-query',       // Yandex DNS
            ];

            // DNS é…ç½®
            const DNS_CONFIG = {
                enable: true,                          // å¯ç”¨DNSåŠŸèƒ½
                'cache-algorithm': 'arc',              // DNSç¼“å­˜ç®—æ³• lru or arc
                'prefer-h3': true,                     // ä¼˜å…ˆä½¿ç”¨HTTP/3
                'use-hosts': true,                     // ä½¿ç”¨hostsæ–‡ä»¶
                'use-system-hosts': true,              // ä½¿ç”¨ç³»ç»Ÿä¸»æœºæ–‡ä»¶
                listen: "0.0.0.0:1053",                // ç›‘å¬åœ°å€å’Œç«¯å£
                ipv6: true,                            // å¯ç”¨IPv6æ”¯æŒ
                'enhanced-mode': 'fake-ip',            // å¢å¼ºæ¨¡å¼ä¸ºè™šå‡IP
                'fake-ip-range': '198.18.0.1/16',      // è™šå‡IPèŒƒå›´
                'fake-ip-filter-mode': 'blacklist',    // è™šå‡IPè¿‡æ»¤æ¨¡å¼
                'fake-ip-filter': [
                    "+.lan",                             // æœ¬åœ°ä¸»æœºå’Œè®¾å¤‡
                    "+.local",                           // æœ¬åœ°ä¸»æœºå’Œè®¾å¤‡
                    "+.msftconnecttest.com",             // Windowsç½‘ç»œæ£€æµ‹
                    "+.msftncsi.com",                    // Windowsç½‘ç»œæ£€æµ‹
                    "localhost.ptlogin2.qq.com",         // QQå¿«é€Ÿç™»å½•æ£€æµ‹å¤±è´¥
                    "localhost.sec.qq.com",              // QQå¿«é€Ÿç™»å½•æ£€æµ‹å¤±è´¥
                    "localhost.work.weixin.qq.com"       // å¾®ä¿¡å¿«é€Ÿç™»å½•æ£€æµ‹å¤±è´¥
                ],
                'default-nameserver': [                  // é»˜è®¤DNSæœåŠ¡å™¨
                    '223.6.6.6',
                    '114.114.115.115',
                    '1.1.1.1',
                    '8.8.8.8',
                ],
                'nameserver-policy': {                  // DNSæœåŠ¡å™¨ç­–ç•¥
                    'geosite:private,cn,geolocation-cn': [
                        ...DNS_CN,
                    ],
                    'geosite:google,youtube,telegram,gfw,geolocation-!cn': [
                        ...DNS_GLOBAL,
                    ]
                },
                nameserver: [
                    ...DNS_CN,                                // å›½å†… DNS
                    ...DNS_GLOBAL,                            // å›½å¤– DNS
                ],
                'direct-nameserver': [                        // ç›´è¿ DNS æœåŠ¡å™¨
                    ...DNS_CN,
                ],
                fallback: [
                    'https://101.101.101.101/dns-query',     // å°æ¹¾Quad 101
                    'https://dns.twnic.tw/dns-query',        // TWNIC DNS
                    'https://sky.rethinkdns.com/dns-query',  // RethinkDNS
                    // 'https://doh.dns.sb/dns-query',          // DNS.SB
                    // 'https://public.dns.iij.jp/dns-query',   // IIJ
                    // 'tls://8.8.8.8:853',                     // Google DNSï¼Œä½¿ç”¨ TLS åè®®
                    // 'tls://1.1.1.1:853',                     // Cloudflare DNSï¼Œä½¿ç”¨ TLS åè®®
                    // '168.95.1.1',                            // TWNIC DNSï¼Œç›´æ¥ä½¿ç”¨ IP åœ°å€
                ],
                'fallback-filter': {
                    geoip: true,
                    'geoip-code': 'CN',
                    geosite: ['gfw'],
                    ipcidr: ['240.0.0.0/4', '0.0.0.0/32'],
                    domain: [
                        '+.google.com',
                        '+.facebook.com',
                        '+.youtube.com'
                    ]
                }
            };

            // åˆå¹¶åŸæœ‰ DNS é…ç½®å’Œæ–°çš„ DNS é…ç½®
            rawObj.dns = { ...rawObj.dns, ...DNS_CONFIG };

            const snifferConfig = {
                enable: true,
                'force-dns-mapping': true,
                'parse-pure-ip': true,
                'override-destination': true,
                sniff: {
                    HTTP: {
                        ports: [80, '8080-8880'],
                        'override-destination': true
                    },
                    TLS: {
                        ports: [443, 8443]
                    },
                    QUIC: {
                        ports: [443, 8443]
                    }
                },
                'force-domain': [
                    '+.v2ex.com'
                ],
                'skip-domain': [
                    'Mijia Cloud'
                ],
                'skip-src-address': [
                    '192.168.0.3/32'
                ],
                'skip-dst-address': [
                    '192.168.0.3/32'
                ]
            };

            // å°†å¤„ç†åçš„ rules é…ç½®æ·»åŠ åˆ° rawObj ä¸­
            rawObj.sniffer = snifferConfig;

            // è¿”å›å¤„ç†åçš„ YAML æ•°æ®
            return yaml.stringify(rawObj);
        };
