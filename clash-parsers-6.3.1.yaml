parsers: # array
  # - reg: ^.*$ åŒ¹é…æ‰€æœ‰è®¢é˜…ï¼Œæˆ–  - url: https://example.com/profile.yaml æŒ‡å®šè®¢é˜…
  - reg: ^.*$
    # åˆ é™¤æœåŠ¡å•†æä¾›çš„ç­–ç•¥ç»„å’Œè§„åˆ™
    code: |
      // ==============================================================================
      // 1. å¸¸é‡    å®šä¹‰åŒºåŸŸ
      // ==============================================================================

      // è¿‡æ»¤æ£€æŸ¥ï¼šå®šä¹‰éœ€è¦åˆ é™¤çš„åŒ…å«å…³é”®è¯çš„èŠ‚ç‚¹
      const KEYWORDS_TO_CHECK = new Set(["25å€"]);

      // é‡å‘½åç§»é™¤ï¼šå®šä¹‰éœ€è¦ä»èŠ‚ç‚¹åç§°ä¸­ç§»é™¤çš„å­—ç¬¦ä¸²
      // ä½œç”¨ï¼šåªåˆ é™¤åç§°ä¸­çš„æ–‡å­—ï¼Œä¸åˆ é™¤èŠ‚ç‚¹æœ¬èº«ã€‚ä¾‹å¦‚ "é¦™æ¸¯ [2.0]" -> "é¦™æ¸¯"ã€‚
      const RENAME_REMOVE_KEYWORDS = new Set([
          "Lv3 ", " [2.0]", "[Trojan]",
          "ğŸ‡­ğŸ‡°", "ğŸ‡¹ğŸ‡¼", "ğŸ‡¸ğŸ‡ª", "ğŸ‡©ğŸ‡ª", "ğŸ‡¨ğŸ‡³", "ğŸ‡¯ğŸ‡µ", "ğŸ‡¸ğŸ‡¬", "ğŸ‡ºğŸ‡¸", "ğŸ‡°ğŸ‡·", "ğŸ‡¦ğŸ‡º", "ğŸ‡®ğŸ‡³", "ğŸ‡¨ğŸ‡¦",
          "ğŸ‡²ğŸ‡½", "ğŸ‡®ğŸ‡¹", "ğŸ‡³ğŸ‡±", "ğŸ‡ªğŸ‡¸", "ğŸ‡¬ğŸ‡§", "ğŸ‡«ğŸ‡·", "ğŸ‡®ğŸ‡±", "ğŸ‡¸ğŸ‡¦", "ğŸ‡¿ğŸ‡¦", "ğŸ‡¦ğŸ‡ª", "ğŸ‡§ğŸ‡·", "ğŸ‡¨ğŸ‡±", "ğŸ‡¨ğŸ‡´", "ğŸ‡¨ğŸ‡­", "ğŸ‡¹ğŸ‡­",
          "[å€ç‡:0.8]", "[å€ç‡:0.9]", "[å€ç‡:1]",
      ]);

      // é‡å‘½åæ·»åŠ ï¼šåœ¨èŠ‚ç‚¹åç§°å‰æ·»åŠ emojiå›¾æ ‡
      const KEYWORDS_TO_ADD = {
          "é¦™æ¸¯|æ¸¯": "ğŸ¬ ",
          "å°æ¹¾|å°": "ğŸ¸ ",
          "æ¾³é—¨": "ğŸ¹ ",
          "ç¾å›½|åŠ æ‹¿å¤§": "ğŸ¦… ",
          "æ—¥æœ¬": "ğŸ” ",
          "éŸ©å›½": "ğŸ¶ ",
          "å°åº¦|æ³°å›½": "ğŸ˜ ",
          "æ–°åŠ å¡|é©¬æ¥è¥¿äºš": "ğŸµ ",
          "æ¾³å¤§åˆ©äºš": "ğŸ¨ ",
          "è¿ªæ‹œ|æ²™ç‰¹é˜¿æ‹‰ä¼¯|é˜¿è”é…‹|ä»¥è‰²åˆ—|å—é": "ğŸª ",
          "å·´è¥¿|å¢¨è¥¿å“¥|æ™ºåˆ©|å“¥ä¼¦æ¯”äºš": "ğŸ¦œ ",
          "ä¿„ç½—æ–¯": "ğŸ» ",
          "å¾·å›½|è‹±å›½|ç‘å…¸|æ³•å›½|è·å…°|åœŸè€³å…¶|æ„å¤§åˆ©|è¥¿ç­ç‰™|ç‘å£«": "ğŸ¦„ "
      };

      // æ–‡æœ¬æ›¿æ¢ï¼šå°†èŠ‚ç‚¹åç§°ä¸­çš„æŸäº›è¯æ›¿æ¢ä¸ºå…¶ä»–è¯
      const REPLACE_MAP = {
          "å‚»é€¼": "SB"
      };

      // è§„åˆ™å®šä¹‰ï¼šè§„åˆ™åˆ—è¡¨,åŒ…å«è‡ªå®šä¹‰è§„åˆ™å’Œå¼•ç”¨çš„è§„åˆ™é›† (RULE-SET)
      const rulesConfig = [
          // è‡ªå®šä¹‰ç¨‹åºè§„åˆ™
          "PROCESS-NAME,DownloadServer.exe,DIRECT",                    // PikPak ç›´è¿
          "PROCESS-NAME,PikPak.exe,DIRECT",                            // PikPak ç›´è¿
          "PROCESS-NAME,WinStore.App.exe,DIRECT",                      // Microsoft store ç›´è¿
          "PROCESS-NAME,ForzaHorizon5.exe,DIRECT",                     // Forza Horizon 5 ç›´è¿
          "PROCESS-NAME,SearchApp.exe,DIRECT",                         // SearchApp ç›´è¿

          // è‡ªå®šä¹‰è§„åˆ™
          "DOMAIN-SUFFIX,agaghhh.cc,DIRECT",                           // x1080x ç›¸å…³åŸŸåç›´è¿
          // "DOMAIN-SUFFIX,nvidia.com,DIRECT",                    
          "DOMAIN-SUFFIX,rewards.bing.com,DIRECT",                     // Bing ç›¸å…³åŸŸåç›´è¿
          "DOMAIN-SUFFIX,adobe.io,REJECT",                             // é˜²æ­¢ adobe å¼¹çª—
          "DOMAIN,lcs-cops.adobe.io,DIRECT",                           // é˜²æ­¢ adobe å¼¹çª—

          "DOMAIN-KEYWORD,dmm,ğŸŒ æ—¥æœ¬èŠ‚ç‚¹",
          "DOMAIN-KEYWORD,javdb,ğŸ˜» æˆ‘è¦æ¶©æ¶©",                           // javdb
          "DOMAIN-SUFFIX,gzankun.com,ğŸ˜» æˆ‘è¦æ¶©æ¶©",                      // javdb é¢„è§ˆè§†é¢‘æº
          "DOMAIN-SUFFIX,jdbstatic.com,ğŸ˜» æˆ‘è¦æ¶©æ¶©",                    // javdb é™æ€èµ„æº
          // "DOMAIN-SUFFIX,urlimage.cc,ğŸ¤– äººå·¥æ™ºèƒ½",             
          // "DOMAIN-KEYWORD,sijishe,ğŸ¤– äººå·¥æ™ºèƒ½",              
          // "DOMAIN-SUFFIX,sjscn.cc,ğŸ¤– äººå·¥æ™ºèƒ½",              
          // "DOMAIN-KEYWORD,sjs47,ğŸ¤– äººå·¥æ™ºèƒ½",                
          "DOMAIN-SUFFIX,nicovideo.jp,ğŸŒ æ—¥æœ¬èŠ‚ç‚¹",

          // å®˜æ–¹è§„åˆ™é›†å¼•ç”¨
          "RULE-SET,privateip,DIRECT,no-resolve",
          "RULE-SET,private,DIRECT",
          "RULE-SET,telegramip,ğŸš€ èŠ‚ç‚¹é€‰æ‹©,no-resolve",
          "RULE-SET,ads,REJECT",

          "RULE-SET,networktest,DIRECT",
          "RULE-SET,trackerslist,DIRECT",
          "RULE-SET,applications,DIRECT",
          "RULE-SET,apple-cn,DIRECT",
          "RULE-SET,microsoft-cn,DIRECT",
          "RULE-SET,google-cn,DIRECT",
          "RULE-SET,xbox,DIRECT",
          "RULE-SET,steamcn,DIRECT",
          "RULE-SET,games-cn,DIRECT",

          "RULE-SET,googlefcm,ğŸš€ èŠ‚ç‚¹é€‰æ‹©",
          "RULE-SET,netflix,ğŸš€ èŠ‚ç‚¹é€‰æ‹©",
          "RULE-SET,youtube,ğŸš€ èŠ‚ç‚¹é€‰æ‹©",
          "RULE-SET,ai,ğŸ¤– äººå·¥æ™ºèƒ½",
          "RULE-SET,media,ğŸš€ èŠ‚ç‚¹é€‰æ‹©",
          "RULE-SET,games,ğŸš€ èŠ‚ç‚¹é€‰æ‹©",

          "RULE-SET,proxy,ğŸš€ èŠ‚ç‚¹é€‰æ‹©",
          "RULE-SET,cn,DIRECT",
          "RULE-SET,mediaip,ğŸš€ èŠ‚ç‚¹é€‰æ‹©",
          "RULE-SET,gamesip,DIRECT",
          "RULE-SET,cnip,DIRECT",
          "MATCH,ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
      ];

      // ==============================================================================
      // 2. å·¥å…·å‡½æ•°å®šä¹‰ (è§£è€¦é€»è¾‘ï¼Œæé«˜å¤ç”¨æ€§)
      // ==============================================================================

      // æ ¸å¿ƒåŒ¹é…å·¥å…·ï¼šåˆ¤æ–­ name æ˜¯å¦åŒ¹é… rule
      const checkMatch = (name, rule) => {
          if (!name) return false;
          // å¦‚æœè§„åˆ™æ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨ .test()
          if (rule instanceof RegExp) {
              return rule.test(name);
          }
          // å¦‚æœè§„åˆ™æ˜¯æ™®é€šå­—ç¬¦ä¸²ï¼Œç”¨ .includes()
          return name.includes(rule);
      };

      // æ­£åˆ™è½¬ä¹‰å‡½æ•°ï¼šé˜²æ­¢å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ [ ] .ï¼‰ç ´åæ­£åˆ™ç»“æ„
      const escapeRegExp = (string) => {
          return string.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
      };

      // åœ¨ name å­—æ®µå‰é¢æ·»åŠ æŒ‡å®šå…³é”®è¯
      // ä¼˜åŒ–ï¼šä½¿ç”¨å•æ¬¡æ­£åˆ™åŒ¹é… + Map æ˜ å°„ï¼Œå¤§å¹…æå‡åŒ¹é…æ•ˆç‡
      const addKeywords = (name, regex, iconMap) => {
          if (!name) return name;
          // æ‰§è¡Œä¸€æ¬¡åŒ¹é…ï¼Œå¦‚æœå‘½ä¸­ï¼Œç›´æ¥ä» Map ä¸­å–å‡ºå¯¹åº”çš„å›¾æ ‡
          const match = name.match(regex);
          if (match) {
              return iconMap.get(match[0]) + name;
          }
          return name;
      };

      // æ‰¹é‡æ›¿æ¢ name å­—æ®µä¸­çš„æ–‡æœ¬
      const replaceText = (name, replaceMap) => {
          if (!name) return name;
          let newName = name;
          for (const [search, replacement] of Object.entries(replaceMap)) {
              // ä½¿ç”¨ replaceAll æ›¿æ¢æ‰€æœ‰å‡ºç°çš„ç›®æ ‡è¯
              newName = newName.split(search).join(replacement);
          }
          return newName;
      };

      // å®šä¹‰é«˜çº§ç­›é€‰å™¨
      // ä¼˜åŒ–ï¼šåˆå¹¶ filter é€»è¾‘ï¼Œä¸€æ¬¡éå†å®ŒæˆåŒ…å«å’Œæ’é™¤
      const furtherFilter = (proxies, includeKeywords = [], excludeKeywords = []) => proxies
          .filter(name => {
              const matchInclude = includeKeywords.length === 0 || includeKeywords.some(rule => checkMatch(name, rule));
              const matchExclude = excludeKeywords.length > 0 && excludeKeywords.some(rule => checkMatch(name, rule));
              return matchInclude && !matchExclude;
          });

      // ==============================================================================
      // 3. é€»è¾‘å¤„ç†å‡½æ•° (Logic Handlers)
      // ==============================================================================

      // ä»£ç†å¤„ç†ä¸»é€»è¾‘ï¼šè¿‡æ»¤ã€é‡å‘½åã€åŠ å›¾æ ‡ã€å»é‡
      function processProxies(rawProxies) {
          let proxies = [...rawProxies];

          // [æ€§èƒ½ä¼˜åŒ–] é¢„ç¼–è¯‘ KEYWORDS_TO_ADDï¼šæ„å»º "å…³é”®è¯->å›¾æ ‡" æ˜ å°„è¡¨ å’Œ "ç»„åˆæ­£åˆ™"
          // ä½œç”¨ï¼šå°†æ•°åæ¬¡æ­£åˆ™åŒ¹é…åˆå¹¶ä¸ºä¸€æ¬¡ï¼Œé€šè¿‡ Map O(1) è·å–å›¾æ ‡
          const iconMap = new Map();
          const iconKeywords = [];

          Object.entries(KEYWORDS_TO_ADD).forEach(([keysStr, icon]) => {
              keysStr.split("|").forEach(key => {
                  iconMap.set(key, icon);
                  iconKeywords.push(escapeRegExp(key));
              });
          });

          // æ’åºï¼šæŒ‰é•¿åº¦é™åºæ’åˆ—ï¼Œç¡®ä¿ "æ–°åŠ å¡" ä¼˜å…ˆåŒ¹é…ï¼Œè€Œä¸æ˜¯åªåŒ¹é…åˆ° "æ–°"
          iconKeywords.sort((a, b) => b.length - a.length);
          // ç”Ÿæˆç»„åˆæ­£åˆ™ï¼š/é¦™æ¸¯|æ¸¯|å°æ¹¾|å°|.../
          const iconsRegex = new RegExp(iconKeywords.join("|"));

          // [æ€§èƒ½ä¼˜åŒ–] é¢„ç¼–è¯‘ RENAME_REMOVE_KEYWORDS ä¸ºå•ä¸€æ­£åˆ™
          const removeKeywordsRegex = new RegExp(
              [...RENAME_REMOVE_KEYWORDS].map(escapeRegExp).join("|"),
              "g"
          );

          // [æ­¥éª¤ 1] é¢„è¿‡æ»¤ï¼šå½»åº•ç§»é™¤åŒ…å«ç‰¹å®šå…³é”®è¯ï¼ˆå¦‚"25å€"ï¼‰çš„èŠ‚ç‚¹
          const keywordsToCheckArr = [...KEYWORDS_TO_CHECK];
          proxies = proxies.filter(proxy =>
              !keywordsToCheckArr.some(keyword => proxy.name.includes(keyword))
          );

          // [æ­¥éª¤ 2] èŠ‚ç‚¹æ¸…æ´—ï¼šé‡å‘½åã€åŠ å›¾æ ‡ã€æ–‡æœ¬æ›¿æ¢
          proxies = proxies.map(proxy => {
              let newName = proxy.name;
              newName = newName.replace(removeKeywordsRegex, "");
              newName = addKeywords(newName, iconsRegex, iconMap);
              newName = replaceText(newName, REPLACE_MAP);

              proxy.name = newName;
              return proxy;
          });

          // [æ­¥éª¤ 3] å…œåº•ä¿éšœï¼šæ— è®ºæ˜¯å¦æœ‰èŠ‚ç‚¹ï¼Œéƒ½å¼ºåˆ¶æ·»åŠ ä¸€ä¸ªâ€œæ— ç›¸å…³èŠ‚ç‚¹â€,é˜²æ­¢å› æ‰€æœ‰èŠ‚ç‚¹éƒ½è¢«è¿‡æ»¤å¯¼è‡´ Clash å¯åŠ¨å¤±è´¥
          proxies.push({
              name: "ğŸˆšï¸ æ— ç›¸å…³èŠ‚ç‚¹",
              type: "ss",
              server: "0.0.0.0",
              port: 443,
              password: "password",
              cipher: "chacha20-ietf-poly1305",
              udp: true
          });

          return proxies;
      }

      // è¿‡æ»¤æ’é™¤ï¼šå®šä¹‰éœ€è¦ä»â€œå¸¸è§„åˆ†ç»„â€ä¸­å‰”é™¤å¸¦å…³é”®è¯çš„èŠ‚ç‚¹
      const FILTER_EXCLUDE_KEYWORDS = [
          /x([2-9]|\d{2,})/i,  // æ­£åˆ™ï¼šæŠ“å– x2, x3... x100ç­‰
          "å‰©ä½™", "ink", "é˜²å¤±è”", "èŠ‚ç‚¹è¶…æ—¶è¯·", "å®˜ç½‘", "æ”¶è—å¯¼èˆª", "å¥—é¤åˆ°æœŸ", "é•¿æœŸæœ‰æ•ˆ", "å€ç‡æ˜¯æµé‡",
          "[å€ç‡:1.7]", "[å€ç‡:2]", "[å€ç‡:2.5]", "ğŸˆšï¸ æ— ç›¸å…³èŠ‚ç‚¹",
          "ä¸“çº¿", "ä¸“ç”¨", "é«˜çº§", "ç›´è¿", "æ€¥é€Ÿ", "é«˜é€Ÿ", "é«˜å€ç‡", "æ¸¸æˆ", "é“‚é‡‘", "é’»çŸ³", "ä¼ä¸š",
          "VIP", "Ultra", "Game", "IEPL", "IPLC", "AIA", "GIA", "CN2", "CMI", "CTM", "CC", "AC"
      ];

      function generateProxyGroups(allProxies, filteredProxies) {
          // é€šç”¨ä»£ç†ç»„é…ç½®ï¼ˆLazy Load, Interval ç­‰ï¼‰
          const commonConfig = {
              interval: 1800,                                  // å¥åº·æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰
              tolerance: 50,                                   // å®¹å·®å€¼ï¼ˆæ¯«ç§’ï¼‰
              timeout: 1800,                                   // è¶…æ—¶æ—¶é—´
              url: "http://www.gstatic.com/generate_204",      // è¿æ¥æµ‹è¯• URLï¼Œé select ç±»å‹åˆ†ç»„å¿…è¦
              lazy: true,                                      // å¯ç”¨æ‡’åŠ è½½ï¼Œæ²¡é€‰ä¸­å°±ä¸éœ€è¦æ£€æµ‹
              maxFailedTimes: 3,                               // æœ€å¤§å¤±è´¥æ¬¡æ•°
              strategy: "consistent-hashing",                  // è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼šå°†ç›¸åŒçš„ç›®æ ‡åœ°å€çš„è¯·æ±‚åˆ†é…ç»™ç­–ç•¥ç»„å†…çš„åŒä¸€ä¸ªä»£ç†èŠ‚ç‚¹
              hidden: false                                    // æ˜¯å¦éšè—
          };

          /*
              ç­–ç•¥ç»„ type ç±»å‹è¯´æ˜
                  select                  # æ‰‹åŠ¨é€‰ç‚¹
                  url-test                # è‡ªåŠ¨é€‰æ‹©å»¶è¿Ÿæœ€ä½çš„èŠ‚ç‚¹
                  fallback                # èŠ‚ç‚¹æ•…éšœæ—¶è‡ªåŠ¨åˆ‡æ¢ä¸‹ä¸€ä¸ª
                  load-balance            # å‡è¡¡ä½¿ç”¨åˆ†ç»„å†…çš„èŠ‚ç‚¹
          
              è´Ÿè½½å‡è¡¡ load-balance        ç­–ç•¥è¯´æ˜
                  round-robin             å°†ä¼šæŠŠæ‰€æœ‰çš„è¯·æ±‚åˆ†é…ç»™ç­–ç•¥ç»„å†…ä¸åŒçš„ä»£ç†èŠ‚ç‚¹
                  consistent-hashing      å°†ç›¸åŒçš„ ç›®æ ‡åœ°å€ çš„è¯·æ±‚åˆ†é…ç»™ç­–ç•¥ç»„å†…çš„åŒä¸€ä¸ªä»£ç†èŠ‚ç‚¹
                  sticky-sessions         å°†ç›¸åŒçš„ æ¥æºåœ°å€ å’Œ ç›®æ ‡åœ°å€ çš„è¯·æ±‚åˆ†é…ç»™ç­–ç•¥ç»„å†…çš„åŒä¸€ä¸ªä»£ç†èŠ‚ç‚¹ï¼Œç¼“å­˜ 10 åˆ†é’Ÿè¿‡æœŸ
          */

          const FALLBACK_PROXIES = ["ğŸˆšï¸ æ— ç›¸å…³èŠ‚ç‚¹", "â±ï¸ å»¶è¿Ÿé€‰ä¼˜", "â™»ï¸ è´Ÿè½½å‡è¡¡", "ğŸš‘ æ•…éšœè½¬ç§»"];

          function buildStrategyGroup(source, include = [], exclude = []) {
              const nodes = furtherFilter(source, include, exclude);
              return nodes.length > 0
                  ? { proxies: nodes }
                  : { type: "select", proxies: FALLBACK_PROXIES };
          }

          // å…·ä½“çš„ç­–ç•¥ç»„å®šä¹‰
          const proxyGroups = [
              {
                  ...commonConfig,
                  name: "ğŸš€ èŠ‚ç‚¹é€‰æ‹©",
                  type: "select",
                  proxies: (() => {
                      const nodes = furtherFilter(allProxies, [], []);
                      const prepend = ["â±ï¸ å»¶è¿Ÿé€‰ä¼˜", "â™»ï¸ è´Ÿè½½å‡è¡¡", "ğŸš‘ æ•…éšœè½¬ç§»", "ğŸ’ åœŸè±ªä¸“ç”¨"];
                      return [...prepend, ...nodes];
                  })()
              },
              {
                  ...commonConfig,
                  name: "ğŸ“¢ å…¬å‘Šå±•ç¤º",
                  type: "select",
                  ...buildStrategyGroup(allProxies, [], [])
              },
              {
                  ...commonConfig,
                  name: "ğŸ¤– äººå·¥æ™ºèƒ½",
                  type: "select",
                  url: "https://chatgpt.com",
                  proxies: (() => {
                      const prepend = ["âœ¨ æ™ºèƒ½èŠ‚ç‚¹"];
                      const nodes = furtherFilter(filteredProxies, [], ["ğŸ‡­ğŸ‡°", "æ¸¯", "å¡", "æ¾³é—¨", "hk", "HK", "hongkong", "hong kong"]);
                      return [...prepend, ...nodes];
                  })()
              },
              {
                  ...commonConfig,
                  name: "âœ¨ æ™ºèƒ½èŠ‚ç‚¹",
                  type: "url-test",
                  url: "https://chatgpt.com",
                  hidden: true,
                  ...buildStrategyGroup(filteredProxies, [], ["ğŸ‡­ğŸ‡°", "æ¸¯", "å¡", "æ¾³é—¨", "hk", "HK", "hongkong", "hong kong"])
              },
              {
                  ...commonConfig,
                  name: "ğŸ˜» æˆ‘è¦æ¶©æ¶©",
                  type: "select",
                  url: "https://javdb.com/",
                  proxies: (() => {
                      const prepend = ["ğŸ” æ¶©æ¶©èŠ‚ç‚¹"];
                      const nodes = furtherFilter(filteredProxies, [], ["æ—¥", "ä¸œäº¬", "å¤§é˜ª", "åŸ¼ç‰", "ä¹å·", "jp", "JP", "japan", "Japan"]);
                      return [...prepend, ...nodes];
                  })()
              },
              {
                  ...commonConfig,
                  name: "ğŸ” æ¶©æ¶©èŠ‚ç‚¹",
                  type: "load-balance",
                  url: "https://javdb.com/",
                  hidden: true,
                  ...buildStrategyGroup(filteredProxies, [], ["æ—¥", "ä¸œäº¬", "å¤§é˜ª", "åŸ¼ç‰", "ä¹å·", "jp", "JP", "japan", "Japan"])
              },
              {
                  ...commonConfig,
                  name: "ğŸ’ åœŸè±ªä¸“ç”¨",
                  type: "url-test",
                  ...buildStrategyGroup(
                      allProxies,
                      [
                          /x([2-9]|\d{2,})/i,
                          "[å€ç‡:1.7]", "[å€ç‡:2]", "[å€ç‡:2.5]",
                          "ä¸“çº¿", "ä¸“ç”¨", "é«˜çº§", "ç›´è¿", "æ€¥é€Ÿ", "é«˜é€Ÿ", "é«˜å€ç‡", "æ¸¸æˆ", "é“‚é‡‘", "é’»çŸ³", "ä¼ä¸š",
                          "VIP", "Ultra", "Game", "IEPL", "IPLC", "AIA", "GIA", "CN2", "CMI", "CTM", "CC", "AC"
                      ]
                  )
              },
              {
                  ...commonConfig,
                  name: "ğŸŒ æ—¥æœ¬èŠ‚ç‚¹",
                  type: "load-balance",
                  ...buildStrategyGroup(filteredProxies, ["æ—¥", "ä¸œäº¬", "å¤§é˜ª", "åŸ¼ç‰", "ä¹å·", "jp", "JP", "japan", "Japan"], [])
              },
              {
                  ...commonConfig,
                  name: "â™»ï¸ è´Ÿè½½å‡è¡¡",
                  type: "load-balance",
                  hidden: true,
                  ...buildStrategyGroup(filteredProxies, [], [])
              },
              {
                  ...commonConfig,
                  name: "â±ï¸ å»¶è¿Ÿé€‰ä¼˜",
                  type: "url-test",
                  ...buildStrategyGroup(filteredProxies, [], [])
              },
              {
                  ...commonConfig,
                  name: "ğŸš‘ æ•…éšœè½¬ç§»",
                  type: "fallback",
                  hidden: true,
                  ...buildStrategyGroup(filteredProxies, [], [])
              }
          ];

          return proxyGroups;
      }

      // ç”Ÿæˆè§„åˆ™é›†æä¾›è€… (Rule Providers) é…ç½®
      function generateRuleProviders() {
          // æå–é€šç”¨é…ç½®ï¼Œå‡å°‘ä»£ç å†—ä½™
          const ruleProviderCommon = {
              type: "http",          // è¯·æ±‚ç±»å‹ä¸ºHTTP
              format: "mrs",         // æ–‡ä»¶æ ¼å¼ä¸ºYAML
              interval: 86400        // æ›´æ–°é—´éš”ä¸º86400ç§’ï¼ˆ24å°æ—¶ï¼‰
          };

          return {
              ads: { ...ruleProviderCommon, behavior: "domain", url: "https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/ads.mrs" },
              "apple-cn": { ...ruleProviderCommon, behavior: "domain", url: "https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/apple-cn.mrs" },
              "google-cn": { ...ruleProviderCommon, behavior: "domain", url: "https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/google-cn.mrs" },
              proxy: { ...ruleProviderCommon, behavior: "domain", url: "https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/proxy.mrs" },
              cn: { ...ruleProviderCommon, behavior: "domain", url: "https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/cn.mrs" },
              cnip: { ...ruleProviderCommon, behavior: "ipcidr", url: "https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/cnip.mrs" },
              media: { ...ruleProviderCommon, behavior: "domain", url: "https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/media.mrs" },
              mediaip: { ...ruleProviderCommon, behavior: "ipcidr", url: "https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/mediaip.mrs" },
              telegramip: { ...ruleProviderCommon, behavior: "ipcidr", url: "https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/telegramip.mrs" },
              privateip: { ...ruleProviderCommon, behavior: "ipcidr", url: "https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/privateip.mrs" },
              private: { ...ruleProviderCommon, behavior: "domain", url: "https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/private.mrs" },
              applications: { ...ruleProviderCommon, format: "text", behavior: "classical", url: "https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/applications.list" },
              ai: { ...ruleProviderCommon, behavior: "domain", url: "https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/ai.mrs" },
              youtube: { ...ruleProviderCommon, behavior: "domain", url: "https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/youtube.mrs" },
              netflix: { ...ruleProviderCommon, behavior: "domain", url: "https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/netflix.mrs" },
              xbox: { ...ruleProviderCommon, behavior: "domain", url: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@refs/heads/meta/geo/geosite/xbox.mrs" },
              steamcn: { ...ruleProviderCommon, behavior: "domain", url: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@refs/heads/meta/geo/geosite/steam%40cn.mrs" },
              "microsoft-cn": { ...ruleProviderCommon, behavior: "domain", url: "https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/microsoft-cn.mrs" },
              trackerslist: { ...ruleProviderCommon, behavior: "domain", url: "https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/trackerslist.mrs" },
              "games-cn": { ...ruleProviderCommon, behavior: "domain", url: "https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/games-cn.mrs" },
              "games": { ...ruleProviderCommon, behavior: "domain", url: "https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/games.mrs" },
              gamesip: { ...ruleProviderCommon, behavior: "ipcidr", url: "https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/gamesip.mrs" },
              networktest: { ...ruleProviderCommon, behavior: "domain", url: "https://fastly.jsdelivr.net/gh/DustinWin/ruleset_geodata@refs/heads/mihomo-ruleset/networktest.mrs" },
              googlefcm: { ...ruleProviderCommon, behavior: "domain", url: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@refs/heads/meta/geo/geosite/googlefcm.mrs" }
          };
      }

      // ç”Ÿæˆ DNS è®¾ç½®
      function generateDnsConfig(originalDns) {
          // å›½å†… DNS æœåŠ¡å™¨åˆ—è¡¨
          const DNS_CN = [
              "223.6.6.6",                                                // é˜¿é‡Œäº‘ DNS
              "119.29.29.29",                                             // DNSPod
              "114.114.115.115",                                          // 114DNS
              // "https://doh.pub/dns-query",                             // DOH.PUB
              // "https://dns.alidns.com/dns-query",                      // é˜¿é‡Œäº‘ DNS
              // "https://doh.onedns.net/dns-query",                      // OneDNS
              // "https://doh.360.cn/dns-query",                          // 360 DNS
          ];

          // å›½å¤– DNS æœåŠ¡å™¨åˆ—è¡¨
          const DNS_GLOBAL = [
              "1.1.1.1",                                                  // Cloudflare DNS
              "8.8.8.8",                                                  // Google DNS
              "9.9.9.9",                                                  // Quad9 DNS
              "205.171.3.65",                                             // Verisign DNS
              // "https://1.1.1.1/dns-query",                             // Cloudflare DNS
              // "https://dns.google/dns-query",                          // Google DNS
              // "https://dns.quad9.net/dns-query",                       // Quad9 DNS
              // "https://dns.yandex.ru/dns-query",                       // Yandex DNS
          ];

          // DNS æ ¸å¿ƒé…ç½®
          const DNS_CONFIG = {
              enable: true,                                               // å¯ç”¨ DNS åŠŸèƒ½
              "cache-algorithm": "arc",                                   // DNS ç¼“å­˜ç®—æ³• lru or arc
              "prefer-h3": true,                                          // ä¼˜å…ˆä½¿ç”¨ HTTP/3
              "use-hosts": true,                                          // ä½¿ç”¨ hosts æ–‡ä»¶
              "use-system-hosts": true,                                   // ä½¿ç”¨ç³»ç»Ÿä¸»æœºæ–‡ä»¶
              listen: "0.0.0.0:1053",                                     // ç›‘å¬åœ°å€å’Œç«¯å£
              ipv6: true,                                                 // å¯ç”¨ IPv6 æ”¯æŒ
              "enhanced-mode": "fake-ip",                                 // å¢å¼ºæ¨¡å¼ä¸ºè™šå‡ IP
              "fake-ip-range": "198.18.0.1/16",                           // è™šå‡ IP èŒƒå›´
              "fake-ip-filter-mode": "blacklist",                         // è™šå‡ IP è¿‡æ»¤æ¨¡å¼
              "fake-ip-filter": [                                         // å¿…é¡»è¿”å›çœŸå® IP çš„åŸŸå
                  "+.lan",                                                // æœ¬åœ°ä¸»æœºå’Œè®¾å¤‡
                  "+.local",                                              // æœ¬åœ°ä¸»æœºå’Œè®¾å¤‡
                  "+.msftconnecttest.com",                                // Windows ç½‘ç»œæ£€æµ‹
                  "+.msftncsi.com",                                       // Windows ç½‘ç»œæ£€æµ‹
                  "localhost.ptlogin2.qq.com",                            // QQ å¿«é€Ÿç™»å½•æ£€æµ‹å¤±è´¥
                  "localhost.sec.qq.com",                                 // QQ å¿«é€Ÿç™»å½•æ£€æµ‹å¤±è´¥
                  "localhost.work.weixin.qq.com"                          // å¾®ä¿¡ å¿«é€Ÿç™»å½•æ£€æµ‹å¤±è´¥
              ],                                                          // é»˜è®¤ DNS æœåŠ¡å™¨
              "default-nameserver": ["223.6.6.6", "114.114.115.115", "1.1.1.1", "8.8.8.8"],
              "nameserver-policy": {                                      // DNS åˆ†æµç­–ç•¥
                  "geosite:private,cn,geolocation-cn": [...DNS_CN],
                  "geosite:google,youtube,telegram,gfw,geolocation-!cn": [...DNS_GLOBAL]
              },
              nameserver: [...DNS_CN, ...DNS_GLOBAL],
              "direct-nameserver": [...DNS_CN],                           // ç›´è¿ DNS æœåŠ¡å™¨
              fallback: [                                                 // å›é€€ DNS (ç”¨äºå½“é¦–é€‰ DNS è§£æå¤±è´¥æ—¶)
                  "https://101.101.101.101/dns-query",                    // å°æ¹¾ Quad 101
                  "https://dns.twnic.tw/dns-query",                       // TWNIC DNS
                  "https://sky.rethinkdns.com/dns-query",                 // RethinkDNS
              ],
              "fallback-filter": {                                        // å›é€€è¿‡æ»¤ (é˜²æ­¢ DNS æ±¡æŸ“)
                  geoip: true,
                  "geoip-code": "CN",
                  geosite: ["gfw"],
                  ipcidr: ["240.0.0.0/4", "0.0.0.0/32"],
                  domain: ["+.google.com", "+.facebook.com", "+.youtube.com"]
              }
          };

          // åˆå¹¶åŸæœ‰ DNS é…ç½®å’Œæ–°çš„ DNS é…ç½®
          return { ...originalDns, ...DNS_CONFIG };
      }

      // ç”Ÿæˆå—…æ¢å™¨ (Sniffer) é…ç½®
      function generateSnifferConfig() {
          return {
              enable: true,
              "force-dns-mapping": true,
              "parse-pure-ip": true,
              "override-destination": true,
              sniff: {
                  HTTP: { ports: [80, "8080-8880"], "override-destination": true },
                  TLS: { ports: [443, 8443] },
                  QUIC: { ports: [443, 8443] }
              },
              "force-domain": ["+.v2ex.com"],
              "skip-domain": ["Mijia Cloud"],
              "skip-src-address": ["192.168.0.3/32"],
              "skip-dst-address": ["192.168.0.3/32"]
          };
      }

      // ==============================================================================
      // 4. ä¸»ç¨‹åºå…¥å£ (Main Execution)
      // ==============================================================================

      function main(config) {
          // 1. å¤„ç†ä»£ç†èŠ‚ç‚¹ (æ¸…æ´—ã€é‡å‘½åã€å»é‡)
          const processedProxies = processProxies(config.proxies);

          // 2. èŠ‚ç‚¹åˆ†ç»„è®¡ç®—
          // è·å–æ‰€æœ‰å¤„ç†åçš„èŠ‚ç‚¹åç§°
          const allProxies = processedProxies.map(proxy => proxy.name);
          // å®šä¹‰å†…éƒ¨ä½¿ç”¨çš„èŠ‚ç‚¹ç­›é€‰å™¨ï¼šä»ç»™å®šçš„ä»£ç†åˆ—è¡¨ä¸­ï¼Œå‰”é™¤åŒ¹é… FILTER_EXCLUDE_KEYWORDS çš„èŠ‚ç‚¹
          // ä½œç”¨ï¼šè·å–â€œå¹²å‡€â€çš„èŠ‚ç‚¹ï¼ˆå‰”é™¤äº†é«˜å€ç‡ã€åˆ°æœŸç­‰èŠ‚ç‚¹ï¼‰
          const filteredProxies = processedProxies
              .map(proxy => proxy.name)
              .filter(name => !FILTER_EXCLUDE_KEYWORDS.some(rule => checkMatch(name, rule)));

          // 3. æ›´æ–°é…ç½®
          // å°†ç”Ÿæˆçš„ä»£ç†ç»„å†™å…¥é…ç½®å¯¹è±¡
          config["proxy-groups"] = generateProxyGroups(allProxies, filteredProxies);
          // å°†è§„åˆ™å†™å…¥é…ç½®å¯¹è±¡
          config.rules = rulesConfig;
          // å°†ä»£ç†æä¾›è€…/è§„åˆ™æä¾›è€…å†™å…¥é…ç½®å¯¹è±¡
          config["proxy-providers"] = {};
          config["rule-providers"] = generateRuleProviders();
          // åˆå¹¶åŸæœ‰ DNS é…ç½®å’Œæ–°çš„ DNS é…ç½®
          config.dns = generateDnsConfig(config.dns);
          // åº”ç”¨å—…æ¢é…ç½®
          config.sniffer = generateSnifferConfig();
          // æ›´æ–°å¤„ç†åçš„ä»£ç†åˆ—è¡¨
          config.proxies = processedProxies;

          // è¿”å›ä¿®æ”¹åçš„é…ç½®
          return config;
      }

      module.exports.parse = async (raw, { axios, yaml, notify, console }, { name, url, interval, selected }) => {
          const rawObj = yaml.parse(raw);

          // [å®¹é”™] æ£€æŸ¥ rawObj å’Œ proxies æ˜¯å¦å­˜åœ¨ï¼Œé¿å…ç©ºæŒ‡é’ˆé”™è¯¯
          if (!rawObj || !Array.isArray(rawObj.proxies)) {
              return raw; // å¦‚æœæ•°æ®ä¸åˆæ³•ï¼Œç›´æ¥è¿”å›åŸæ–‡
          }

          // æ‰§è¡Œä¸»é€»è¾‘
          const finalConfig = main(rawObj);

          // è¿”å›å¤„ç†åçš„ YAML æ•°æ®
          return yaml.stringify(finalConfig);
      };

